# PRD Kernel for: 玄机阁 (Xuan Ji Gé) - AI运势推算平台

## 1. 产品概述 (Product Overview)
* **一句话描述**: 一个结合传统东方命理智慧与现代AI深度分析的在线平台，为追求严肃生活指导的年轻用户提供专业、个性化的运势推算与决策参考。
* **目标用户**: 对未来感到好奇或迷茫，希望通过命理学（八字、六爻）获得严肃、深度分析的年轻互联网用户。他们追求高品质、现代化的使用体验。
* **核心问题/价值**: 解决了传统命理服务内容晦涩难懂、用户体验过时的问题。我们通过现代简约的UI/UX、AI赋能的个性化解读以及便捷的社交分享功能，提供一个专业、可信且易于理解的新时代命理服务。

---
## 2. 市场与用户界面 (Marketing & UI)

### 2.1 落地页 (Landing Page - Route: /)
* **风格与文案**: 现代、简约、略带神秘感。主色调可采用深蓝、黑、金的组合。文案直击核心价值：“洞察天机，决策未来。您的AI命理军师。”
* **页面结构 (最佳实践)**:
    * **Hero区**: 引人注目的动态背景（如星辰、水墨），标题：“玄机阁”，副标题：“AI驱动的深度运势分析”，核心价值陈述：“不再是模棱两可的断言，而是结合你生辰八字的个性化深度报告。”，CTA按钮：【立即开始推算】。
    * **Features区**: 分块介绍核心功能：【八字详批 · 洞察一生格局】、【六爻占卜 · 判断当下吉凶】、【AI灵感解读 · 专属你的智慧】、【开运商城 · เสริม旺你的运势】。
    * **Bento Grids**: 使用网格布局生动展示“从输入生日到生成精美分享图片”的全过程。
    * **Social Proof区**: 展示用户匿名好评，例如：“解读非常到位，给了我很大启发”、“界面很舒服，不像别的网站那么乱”。
    * **Pricing区**: 简要展示点数套餐，“最低仅需9.9元即可体验一次深度占卜”。
    * **FAQ区**: 解答常见问题，如“结果准确吗？”、“我的隐私安全吗？”、“点数如何计算？”等。
    * **Final CTA区**: 页脚前最后的行动号召：【注册即送体验点数，开启你的玄机之旅】。
* **用户流程**: 点击任何【开始】或【注册】按钮，未登录用户跳转至登录/注册页；已登录用户重定向到后台核心功能页 `/new-reading`。

### 2.2 价格页 (Pricing Page - Route: /pricing)
* **定价策略 (按次计费 - 点数制)**: 用户通过购买“玄机值”来消费服务。
    * **套餐一 (新手体验包)**: ¥19.9 = 20 玄机值
    * **套餐二 (高级推算包)**: ¥49.9 = 55 玄机值 (加赠5点)
    * **套餐三 (大师尊享包)**: ¥99.9 = 120 玄机值 (加赠20点)
* **服务定价**:
    * 六爻占卜 (短期运势): 消耗 **5** 玄机值
    * 八字详批 (长期运势): 消耗 **15** 玄机值
* **支付流程**: 清晰的套餐卡片，点击【立即充值】按钮后，调用支付接口完成支付。

---
## 3. 后台仪表盘 (Authenticated Dashboard)
* **访问控制**: 所有根路径下的子页面 (如 `/readings`, `/my`, `/mall`) 均需用户登录才能访问。

### 3.1 推算记录 (My Readings - Route: /readings)
* **功能**: 以卡片形式展示用户所有已保存的推算历史（包括八字和六爻）。卡片上应显示推算类型、日期和关键摘要。
* **交互**:
    * 点击项目卡片，跳转至该次推算的详情页 `/readings/:id`。
    * 页面右上角提供一个醒目的【+ 新建推算】按钮，点击后跳转至 `/new-reading`。

### 3.2 新建推算 (New Reading - Route: /new-reading)
* **标题/副标题**: “开启新的推算”，副标题：“请选择你希望洞察的问题类型”。
* **核心流程 (步骤条或选项卡实现)**:
    1.  **步骤 1: 选择推算类型**:
        * 提供两个大的选项卡：【八字详批 · 探寻长期运势】和【六爻占卜 · 决断短期事务】。
    2.  **步骤 2: 提供信息 & 支付**:
        * **如果选八字**: 显示一个精准的公历/农历生日时辰选择器。下方明确标注：“本次详批将消耗 **15** 玄机值”。
        * **如果选六爻**: 页面显示一个引导性问题输入框（可选，如“您想问何事？”），核心是一个【心诚则灵，点击起卦】的按钮。下方明确标注：“本次占卜将消耗 **5** 玄机值”。
        * **支付确认**: 点击“生成结果”按钮时，后端检查用户“玄机值”余额。若不足，则弹窗提示：“玄机值不足，请先充值。”，并提供一个跳转到 `/pricing` 的按钮。
    3.  **步骤 3: 查看与分享结果**:
        * **文档生成**: 后端完成命盘/卦象计算，然后调用AI接口，将原始数据和精心设计的Prompt发送给AI模型，生成个性化、深度、易懂的解读文案。
        * **内容展示**: 使用Tabs组件清晰地分隔不同维度的解读内容。
            * **八字**: [命盘信息], [性格分析], [事业财运], [婚恋家庭], [健康建议], [AI深度总结]
            * **六爻**: [卦象详情], [所问之事吉凶], [应期判断], [AI智慧解读]
        * **功能按钮**:
            * 【保存本次记录】: 将本次推算的全部数据（输入、原始结果、AI解读）持久化到数据库。
            * 【生成分享图片】: 调用服务端能力，将核心结果和AI金句渲染到一张设计精美的图片上，供用户下载分享。
            * 【下载完整报告(.pdf)】: 生成一份包含所有信息的PDF文档。

### 3.3 推算详情 (Reading Detail - Route: /readings/:id)
* **功能**: 页面UI/UX与 `/new-reading` 的结果展示页完全一致，但所有数据均从数据库中读取并回显，用户可在此页面回顾历史推算并再次进行分享操作。

### 3.4 个人中心 (My Account - Route: /my)
* **功能**:
    * 显示用户的注册邮箱/昵称。
    * 以醒目方式显示用户当前剩余的【玄机值】。
    * 如果玄机值为0或较低，显示一个【立即充值】的按钮，链接到 `/pricing`。
    * 提供历史订单/充值记录查询。

### 3.5 运势商城 (Luck Mall - Route: /mall)
* **功能**: 以简约的电商陈列风格，展示与开运、禅意相关的商品（如水晶、手链、香薰等）。
* **交互**:
    * 以商品卡片流展示，包含商品图、名称、简述和价格。
    * 点击商品卡片进入商品详情页，有更详细的介绍和【立即购买】按钮。
    * **注意**: 初期可采用引导至外部链接（如淘宝/微店）的方式完成购买，后期再自建完整电商交易闭环。

---
## 4. 技术栈与实施细则 (Tech Stack & Implementation)
* **数据库 (Database)**:
    * **服务**: Supabase (PostgreSQL)。
    * **ORM**: Drizzle ORM，用于数据库交互和Schema管理。
    * **核心数据表**: `users`, `readings` (存储类型、输入、原始结果、AI解读文案), `credits` (用户玄机值), `payments` (支付订单), `products` (商城商品)。
* **支付 (Payments)**:
    * **服务商**: Zpay  参考@docs/z-pay.md。
    * **逻辑**: 支付成功后，通过Webhook触发一个Serverless Function，安全地更新用户的`credits`表。
* **前端 (Frontend)**:
    * **框架**: Next.js (App Router)。
    * **样式**: TailwindCSS + Shadcn/UI 组件库，严格遵循现代简约风格。
* **核心命理计算**:
    * **实现**: 需要引入或自行开发稳定、准确的八字排盘和六爻起卦的JavaScript/TypeScript库。这是项目的核心算法基础。
* **AI集成 (AI Integration)**:
    * **模型**: DeepSeek 参考@docs/ai.md。
    * **SDK**: 使用 OpenAI 兼容的SDK。
    * **Prompt Engineering**: AI调优是关键。Prompt需精心设计，引导AI扮演“命理大师”角色，根据原始数据进行有深度、有文采、有逻辑的分析。
* **图片生成**:
    * **方案**: 使用 Vercel OG Image Generation 或 `satori` 库在服务端动态生成分享图片，确保图片精美且包含动态数据。
* **环境变量 (.env)**:
    * `DATABASE_URL`
    * `NEXT_PUBLIC_SUPABASE_URL`
    * `NEXT_PUBLIC_SUPABASE_ANON_KEY`
    * `DEEPSEEK_API_KEY` (或你选择的AI模型API Key)
    * `ZPAY_PID`
    * `ZPAY_PKEY`
    * `NEXT_PUBLIC_SITE_URL` (用于生成分享链接和回调)